# @proxyflare/client

A lightweight Python client for interacting with Proxyflare worker pools. It provides a manager to handle worker lists and custom transports for `httpx` to enable transparent proxying.

## Features

- **Pool Management**: Automatically load and rotate between multiple Cloudflare Workers.
- **HTTPX Integration**: Direct integration with the `httpx` library via custom transports.
- **Sync & Async Support**: Full support for both synchronous and asynchronous request patterns.

## Installation

The client is part of the `proxyflare` package. Ensure you have the main package installed:

```bash
uv pip install proxyflare
```

## Usage

### 1. Initialize the Manager

The `ProxyflareWorkersManager` manages your pool of workers. You can initialize it with a list of URLs or a JSON file generated by `proxyflare create`.

```python
from proxyflare.client import ProxyflareWorkersManager

# Using a list of URLs
manager = ProxyflareWorkersManager([
    "https://worker-1.your-subdomain.workers.dev",
    "https://worker-2.your-subdomain.workers.dev"
])

# Or loading from a results file
manager = ProxyflareWorkersManager("workers.json")
```

### 2. Basic Proxying (Synchronous)

Use `ProxyflareTransport` with an `httpx.Client` to route all requests through your worker pool.

```python
import httpx
from proxyflare.client import ProxyflareWorkersManager, ProxyflareTransport

manager = ProxyflareWorkersManager("workers.json")
transport = ProxyflareTransport(manager)

with httpx.Client(transport=transport) as client:
    response = client.get("https://api.ipify.org?format=json")
    print(response.json()) # IP will be from one of the Cloudflare Workers
```

### 3. Basic Proxying (Asynchronous)

For async applications, use `AsyncProxyflareTransport` with an `httpx.AsyncClient`.

```python
import asyncio
import httpx
from proxyflare.client import ProxyflareWorkersManager, AsyncProxyflareTransport

async def main():
    manager = ProxyflareWorkersManager("workers.json")
    transport = AsyncProxyflareTransport(manager)

    async with httpx.AsyncClient(transport=transport) as client:
        response = await client.get("https://api.ipify.org?format=json")
        print(response.json())

if __name__ == "__main__":
    asyncio.run(main())
```

## Components

### `ProxyflareWorkersManager`
- `load_from_file(path)`: Loads worker data from a JSON file.
- `get_worker()`: Returns a random worker URL from the pool.

### `ProxyflareTransport` / `AsyncProxyflareTransport`
A custom `httpx` transport that rewrites request URLs to point to the selected worker, passing the original target URL as a query parameter.
